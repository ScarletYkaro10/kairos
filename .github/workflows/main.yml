# Nome do nosso pipeline
name: Kairós CI/CD Pipeline

# Define quando o pipeline deve rodar:
# - Em qualquer "push" para a branch "main"
# - Em qualquer "pull request" que tenha a "main" como alvo
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# Define os "trabalhos" (jobs) que o pipeline vai executar
jobs:
  # Nosso primeiro job: "build-and-test"
  build-and-test:
    # Define a máquina que vai rodar o job (Windows, Mac ou Ubuntu)
    # Ubuntu é o mais rápido e comum para CI
    runs-on: ubuntu-latest

    # Define os "passos" (steps) do job
    steps:
      # Passo 1: "Check-out" (Baixa o código do repositório)
      - name: Check-out code
        uses: actions/checkout@v4

      # Passo 2: "Setup Python" (Configura a versão do Python)
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12' # A versão que estamos usando

      # Passo 3: "Install Dependencies" (Instala nossas bibliotecas)
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Passo 4: "Run Tests" (Roda o Pytest)
      # Este é o passo mais importante!
      - name: Run tests with Pytest
        run: |
          python -m pytest